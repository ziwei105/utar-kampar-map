<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parking Slot Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #mapContainer {
      position: relative;
      width: 600px;
      height: 600px;
      border: 1px solid #333;
    }
    .lot {
      position: absolute;
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }
    .vacant { background-color: green; }
    .occupied { background-color: red; }
  </style>
</head>
<body>
  <h1>UTAR Kampar Parking Slots</h1>
  <div id="mapContainer"></div>

  <script>
    const mapContainer = document.getElementById("mapContainer");

    // Example mapping for positions of lots (you can adjust to match your GeoJSON)
    const lotPositions = {}; // Will be populated from GeoJSON

    // Fetch parking lot GeoJSON
    async function loadGeoJSON() {
      try {
        const response = await fetch("parking-lots.geojson");
        const geojson = await response.json();

        geojson.features.forEach((feature, index) => {
          const lotId = feature.properties.name || `A${index + 1}`;
          const bbox = feature.bbox || [0,0,50,50]; // fallback coordinates
          // Normalize coordinates to fit container (simple example)
          const x = bbox[0];
          const y = bbox[1];
          const width = bbox[2] - bbox[0];
          const height = bbox[3] - bbox[1];

          lotPositions[lotId] = { x, y, width, height };

          const lotDiv = document.createElement("div");
          lotDiv.id = lotId;
          lotDiv.className = "lot vacant";
          lotDiv.style.left = x + "px";
          lotDiv.style.top = y + "px";
          lotDiv.style.width = width + "px";
          lotDiv.style.height = height + "px";
          lotDiv.innerText = lotId;
          mapContainer.appendChild(lotDiv);
        });

      } catch (error) {
        console.error("Error loading GeoJSON:", error);
      }
    }

    // Fetch parking status from API and update lots
    async function fetchParkingData() {
      try {
        const response = await fetch("https://of3greluu9.execute-api.ap-southeast-1.amazonaws.com/slots");
        const data = await response.json();

        data.forEach(item => {
          const lotDiv = document.getElementById(item.slot_id);
          if (lotDiv) {
            lotDiv.className = item.status.toLowerCase() === "occupied" ? "lot occupied" : "lot vacant";
          }
        });
      } catch (error) {
        console.error("Error fetching parking data:", error);
      }
    }

    // Initialize
    loadGeoJSON().then(() => {
      fetchParkingData();
      setInterval(fetchParkingData, 5000);
    });
  </script>
</body>
</html>

