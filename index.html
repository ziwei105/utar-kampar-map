<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parking Slot Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #mapContainer {
      position: relative;
      width: 600px;
      height: 600px;
      border: 1px solid #333;
    }
    .lot {
      position: absolute;
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      text-align: center;
    }
    .vacant { background-color: green; }
    .occupied { background-color: red; }
  </style>
</head>
<body>
  <h1>UTAR Kampar Parking Slots</h1>
  <div id="mapContainer"></div>

  <script>
    const mapContainer = document.getElementById("mapContainer");
    const containerWidth = mapContainer.clientWidth;
    const containerHeight = mapContainer.clientHeight;

    let geoBounds = { minX: Infinity, maxX: -Infinity, minY: Infinity, maxY: -Infinity };
    const lotPositions = {};

    // Fetch GeoJSON
    async function loadGeoJSON() {
      try {
        const response = await fetch("parking-lots.geojson");
        const geojson = await response.json();

        // First, find min/max coordinates
        geojson.features.forEach(feature => {
          const [lon, lat] = feature.geometry.coordinates;
          if (lon < geoBounds.minX) geoBounds.minX = lon;
          if (lon > geoBounds.maxX) geoBounds.maxX = lon;
          if (lat < geoBounds.minY) geoBounds.minY = lat;
          if (lat > geoBounds.maxY) geoBounds.maxY = lat;
        });

        // Create lot divs
        geojson.features.forEach((feature, index) => {
          const lotId = feature.properties.name || `A${index + 1}`;
          const [lon, lat] = feature.geometry.coordinates;

          // Normalize coordinates to fit container
          const x = ((lon - geoBounds.minX) / (geoBounds.maxX - geoBounds.minX)) * containerWidth;
          const y = containerHeight - ((lat - geoBounds.minY) / (geoBounds.maxY - geoBounds.minY)) * containerHeight;

          const lotDiv = document.createElement("div");
          lotDiv.id = lotId;
          lotDiv.className = "lot vacant";
          lotDiv.style.left = `${x - 15}px`; // offset half width
          lotDiv.style.top = `${y - 15}px`;  // offset half height
          lotDiv.style.width = "30px";
          lotDiv.style.height = "30px";
          lotDiv.innerText = lotId;

          mapContainer.appendChild(lotDiv);
          lotPositions[lotId] = lotDiv;
        });

      } catch (error) {
        console.error("Error loading GeoJSON:", error);
      }
    }

    // Fetch parking status from API and update lots
    async function fetchParkingData() {
      try {
        const response = await fetch("https://of3greluu9.execute-api.ap-southeast-1.amazonaws.com/slots");
        const data = await response.json();

        data.forEach(item => {
          const lotDiv = lotPositions[item.slot_id];
          if (lotDiv) {
            lotDiv.className = item.status.toLowerCase() === "occupied" ? "lot occupied" : "lot vacant";
          }
        });
      } catch (error) {
        console.error("Error fetching parking data:", error);
      }
    }

    // Initialize
    loadGeoJSON().then(() => {
      fetchParkingData();
      setInterval(fetchParkingData, 5000);
    });
  </script>
</body>
</html>


