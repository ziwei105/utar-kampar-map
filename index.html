<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parking Slot Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .parking-grid {
      display: grid;
      grid-template-columns: repeat(10, 60px);
      gap: 10px;
      margin-bottom: 40px;
    }
    .slot {
      width: 60px;
      height: 60px;
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      cursor: pointer;
    }
    .vacant { background-color: green; }
    .occupied { background-color: red; }
    #mapContainer {
      width: 100%;
      height: 400px;
      border: 1px solid #333;
      padding: 10px;
      overflow: auto;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h1>UTAR Kampar Parking Slots</h1>

  <!-- Schematic Parking Grid -->
  <div class="parking-grid" id="parkingGrid"></div>

  <!-- Map Section -->
  <h2>Campus Parking Map</h2>
  <div id="mapContainer">Loading map...</div>

  <script>
    const totalSlots = 50;
    const parkingGrid = document.getElementById("parkingGrid");

    // Create schematic slots
    for (let i = 1; i <= totalSlots; i++) {
      const slot = document.createElement("div");
      slot.id = `slot${i}`;
      slot.className = "slot vacant";
      slot.innerText = `A${i}`;
      parkingGrid.appendChild(slot);
    }

    // Fetch parking data from API
    async function fetchParkingData() {
      try {
        const response = await fetch("https://of3greluu9.execute-api.ap-southeast-1.amazonaws.com/slots");
        const data = await response.json();

        data.forEach(item => {
          const slotDiv = document.getElementById(item.slot_id.replace('A','slot'));
          if (slotDiv) {
            slotDiv.className = item.status.toLowerCase() === "occupied" ? "slot occupied" : "slot vacant";
          }
        });
      } catch (error) {
        console.error("Error fetching parking data:", error);
      }
    }

    // Update every 5 seconds
    fetchParkingData();
    setInterval(fetchParkingData, 5000);

    // Load GeoJSON map
    fetch('public/parking-lots.geojson')
      .then(res => res.json())
      .then(geojson => {
        const mapContainer = document.getElementById("mapContainer");
        mapContainer.innerText = JSON.stringify(geojson, null, 2);
      })
      .catch(err => console.error("Error loading GeoJSON:", err));
  </script>
</body>
</html>
