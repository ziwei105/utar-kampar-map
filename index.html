<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parking Slot Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #mapContainer {
      position: relative;
      width: 600px;
      height: 600px;
      border: 1px solid #333;
    }
    .lot {
      position: absolute;
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      text-align: center;
    }
    .vacant { background-color: green; }
    .occupied { background-color: red; }
  </style>
</head>
<body>
  <h1>UTAR Kampar Parking Slots</h1>
  <div id="mapContainer"></div>

  <script>
    const mapContainer = document.getElementById("mapContainer");
    const containerWidth = mapContainer.clientWidth;
    const containerHeight = mapContainer.clientHeight;
    const lotPositions = {};
    let geoBounds = { minX: Infinity, maxX: -Infinity, minY: Infinity, maxY: -Infinity };

    // Load GeoJSON and create lots
    async function loadGeoJSON() {
      try {
        const response = await fetch("public/parking-lots.geojson"); // path to your GeoJSON
        const geojson = await response.json();

        // Determine min/max for normalization
        geojson.features.forEach(feature => {
          const [lon, lat] = feature.geometry.coordinates;
          geoBounds.minX = Math.min(geoBounds.minX, lon);
          geoBounds.maxX = Math.max(geoBounds.maxX, lon);
          geoBounds.minY = Math.min(geoBounds.minY, lat);
          geoBounds.maxY = Math.max(geoBounds.maxY, lat);
        });

        // Create lot divs
        geojson.features.forEach((feature, index) => {
          const lotId = feature.properties.name || `A${index + 1}`;
          const [lon, lat] = feature.geometry.coordinates;

          // Normalize coordinates to container
          const x = ((lon - geoBounds.minX) / (geoBounds.maxX - geoBounds.minX)) * containerWidth;
          const y = containerHeight - ((lat - geoBounds.minY) / (geoBounds.maxY - geoBounds.minY)) * containerHeight;

          const lotDiv = document.createElement("div");
          lotDiv.id = lotId;
          lotDiv.className = "lot vacant";
          lotDiv.style.left = `${x - 15}px`;
          lotDiv.style.top = `${y - 15}px`;
          lotDiv.style.width = "30px";
          lotDiv.style.height = "30px";
          lotDiv.innerText = lotId;

          mapContainer.appendChild(lotDiv);
          lotPositions[lotId] = lotDiv;
        });
      } catch (err) {
        console.error("Error loading GeoJSON:", err);
      }
    }

    // Update lot colors from API
    async function fetchParkingData() {
      try {
        const response = await fetch("https://of3greluu9.execute-api.ap-southeast-1.amazonaws.com/slots");
        const data = await response.json();

        data.forEach(item => {
          const lotDiv = lotPositions[item.slot_id];
          if (lotDiv) {
            lotDiv.className = item.status.toLowerCase() === "occupied" ? "lot occupied" : "lot vacant";
          }
        });
      } catch (err) {
        console.error("Error fetching parking data:", err);
      }
    }

    // Initialize
    loadGeoJSON().then(() => {
      fetchParkingData();
      setInterval(fetchParkingData, 5000);
    });
  </script>
</body>
</html>



